<html><head></head><body><dom-module id="shop-list"><template><style>google-map{height:300px;}</style><h1>Hello [[nameShop]]</h1><google-map fit-to-markers="" api-key="AIzaSyDFsX7B97xHnLZWGD97X6ZGV8H9ZKBiJek" latitude="53.195538" longitude="50.101783"><google-map-marker latitude="{{latitude}}" longitude="{{longitude}}" draggable="true"></google-map-marker></google-map><paper-input bind-value="{{nameShop}}" value="{{nameShop}}" placeholder="Наименование"></paper-input><paper-input id="input" bind-value="{{descriptionShop}}" value="{{descriptionShop}}" placeholder="Описание"></paper-input><paper-input id="input" value="{{searchString}}" placeholder="Строка"></paper-input><button on-click="filter">Filter</button> <button on-click="getAllShops">Get data</button> <button on-click="addShop">Add data</button><google-map fit-to-markers="" api-key="AIzaSyDFsX7B97xHnLZWGD97X6ZGV8H9ZKBiJek" latitude="53.195538" longitude="50.101783"><template is="dom-repeat" items="{{markers}}"><google-map-marker latitude="{{item.latitude}}" longitude="{{item.longitude}}"></google-map-marker></template></google-map><template is="dom-repeat" items="{{shops}}" id="shopList"><div>Name: <span>{{item.name}}</span></div><div>Description: <span>{{item.description}}</span></div><button on-click="delete">x</button> <button on-click="update">update</button></template></template><script>Polymer({is:"shop-list",properties:{nameShop:{type:String},descriptionShop:{type:String},shops:{type:Array,value:[]},markers:{type:Array,value:[]},searchString:{type:String},longitude:{type:Number,value:50.101783},latitude:{type:Number,value:53.195538}},indexedDB:window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,IDBTransaction:window.IDBTransaction||window.webkitIDBTransaction,db:null,ready:function(){this.initDb(),this.getAllShops()},initDb:function(){var a=this.indexedDB.open("BestPriceDatabase",1);a.onsuccess=function(){this.db=a.result},a.onerror=function(a){console.log("IndexedDB error: "+a.target.errorCode)},a.onupgradeneeded=function(a){var b=a.currentTarget.result.createObjectStore("shop",{keyPath:"id",autoIncrement:!0});b.createIndex("name","name"),b.createIndex("coordinates",["longitude","latitude"]);var b=a.currentTarget.result.createObjectStore("productList",{keyPath:"id",autoIncrement:!0});b.createIndex("date_shop",["date","idShop"])}},addShop:function(){var a,b=this.descriptionShop,c=this.nameShop,d=this.longitude,e=this.latitude,f=this,g=this.indexedDB.open("BestPriceDatabase",1);g.onsuccess=function(){a=g.result;var h=a.transaction("shop","readwrite"),i=h.objectStore("shop");i.add({name:c,description:b,longitude:d,latitude:e}),f.getAllShops()}},getData:function(){var a,b=this.nameShop,c=this.indexedDB.open("BestPriceDatabase",1);c.onsuccess=function(){a=c.result;var d=a.transaction("shop","readwrite"),e=d.objectStore("shop"),f=e.index("name"),g=f.get(b);g.onsuccess=function(){this.descriptionShop="111",console.log(this.descriptionShop)}}},getAllShops:function(){this.shops=[];var a,b=this.indexedDB.open("BestPriceDatabase",1),c=this;b.onsuccess=function(){a=b.result;var d=a.transaction("shop","readwrite"),e=d.objectStore("shop"),f=e.openCursor();f.onsuccess=function(a){a.target.result&&(c.push("shops",{id:a.target.result.value.id,name:a.target.result.value.name,description:a.target.result.value.description}),c.push("markers",{latitude:a.target.result.value.latitude,longitude:a.target.result.value.longitude}),a.target.result["continue"]())},console.log(c.markers)}},delete:function(a){var b,c=this.$.shopList.itemForElement(a.target),d=this.descriptionShop,e=this.nameShop,f=this,g=this.indexedDB.open("BestPriceDatabase",1);g.onsuccess=function(){b=g.result;var a=b.transaction("shop","readwrite"),d=a.objectStore("shop");d.delete(c.id),f.getAllShops()}},update:function(a){var b,c=this.$.shopList.itemForElement(a.target),d=this.descriptionShop,e=this.nameShop,f=this,g=this.indexedDB.open("BestPriceDatabase",1);g.onsuccess=function(){b=g.result;var a=b.transaction("shop","readwrite"),d=a.objectStore("shop");c.name=f.nameShop,c.description=f.descriptionShop,d.put(c),f.getAllShops()}},filter:function(){this.shops=[];var a,b=this.indexedDB.open("BestPriceDatabase",1),c=this;b.onsuccess=function(){a=b.result;var d=a.transaction("shop","readonly"),e=d.objectStore("shop"),f=e.index("name");if(null==c.searchString){var g=e.openCursor();g.onsuccess=function(a){a.target.result&&(c.push("shops",{id:a.target.result.value.id,name:a.target.result.value.name,description:a.target.result.value.description}),a.target.result["continue"]())}}else{var g=f.openCursor(IDBKeyRange.bound(c.searchString,c.searchString+"\uFFFF",!0,!0));g.onsuccess=function(a){a.target.result&&(c.push("shops",{id:a.target.result.value.id,name:a.target.result.value.name,description:a.target.result.value.description}),a.target.result["continue"]())}}}}});</script></dom-module></body></html>