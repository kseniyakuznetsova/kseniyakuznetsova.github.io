<html><head></head><body><div hidden="" by-polymer-bundler=""><dom-module id="app-media-devices" assetpath="../bower_components/app-media/"><script>(function(){Polymer({is:'app-media-devices',properties:{kind:{type:String,value:''},devices:{type:Array,readOnly:!0,notify:!0,value:function(){return[]}},selectedDevice:{type:Object,readOnly:!0,notify:!0},selectedDeviceIndex:{type:Number,readOnly:!0,notify:!0,value:0}},observers:['_updateDevices(kind)','_updateSelectedDevice(devices, selectedDeviceIndex)'],selectNextDevice:function(){var a=this.selectedDeviceIndex+1;null!=this.devices&&a<this.devices.length?this._setSelectedDeviceIndex(a):this._setSelectedDeviceIndex(0)},selectPreviousDevice:function(){var a=this.selectedDeviceIndex-1,b=this.devices&&0<this.devices.length?this.devices.length-1:0;null!=this.devices&&a<this.devices.length&&-1<a?this._setSelectedDeviceIndex(a):this._setSelectedDeviceIndex(b)},selectDevice:function(a){var b=this.devices.indexOf(a);if(-1===b)throw new Error('app-media-devices: The given object is not a known device.');this._setSelectedDeviceIndex(b)},_updateSelectedDevice:function(){this.debounce('_updateSelectedDevice',function(){null!=this.devices&&null!=this.selectedDeviceIndex&&this._setSelectedDevice(this.devices[this.selectedDeviceIndex])})},_updateDevices:function(a){try{var b=new RegExp(null==a?'':a,'i'),c=this;navigator.mediaDevices.enumerateDevices().then(function(a){var d=a.filter(function(a){return b.test(a.kind)});c._setSelectedDeviceIndex(0),c._setDevices(d)})}catch(a){this._error(this._logf('Failed to look up media devices.',a))}}})})();</script></dom-module><dom-module id="app-media-stream" assetpath="../bower_components/app-media/"><script>(function(){Polymer({is:'app-media-stream',properties:{audioDevice:{type:Object,value:null},videoDevice:{type:Object,value:null},audioConstraints:{type:Object,value:null},videoConstraints:{type:Object,value:null},stream:{type:Object,notify:!0,readOnly:!0},active:{type:Boolean,notify:!0,value:!1},constraints:{type:Object,readOnly:!0}},observers:['_updateConstraints(audioDevice, videoDevice, audioConstraints, videoConstraints)','_updateStream(constraints, active)'],_combineConstraints:function(a,b){if(null==a&&null==b)return!1;var c=this.extend({},a);return null!=b&&(c.deviceId={exact:b.deviceId}),c},_updateConstraints:function(){this.debounce('_updateConstraints',function(){var a=this._combineConstraints(this.audioConstraints,this.audioDevice),b=this._combineConstraints(this.videoConstraints,this.videoDevice);a||b?this._setConstraints({audio:a,video:b}):this._setConstraints(null)})},_updateStream:function(){this.active&&null!=this.constraints?this.debounce('_updateStream',function(){var a=this;try{null!=this.stream&&this.stream.getTracks().forEach(function(a){a.stop()}),this.__gettingUserMedia=this.__gettingUserMedia||navigator.mediaDevices.getUserMedia(this.constraints).then(function(b){a.__gettingUserMedia=null,a._setStream(a.active?b:null)}).catch(function(b){a.fire('media-stream-error',b),a._error(a._logf('Media stream access rejected.',b))})}catch(a){this.fire('media-stream-error',a),this._error(this._logf('Failed to access media stream.',a))}},1):this._setStream(null)}})})();</script></dom-module><dom-module id="app-media-video" assetpath="../bower_components/app-media/"><template><style>:host{display:flex;align-items:center;justify-content:center;flex-wrap:nowrap;width:100%;height:100%;background:var(--app-media-video-background, #000);overflow:hidden;}video{flex:0 0 auto;transform-origin:center center;position:relative;will-change:transform;}</style><video id="videoElement" on-loadedmetadata="_updateMetrics" muted="[[muted]]" autoplay="[[autoplay]]" loop="[[loop]]" webkit-playsinline="" playsinline=""></video></template><script>(function(){Polymer({is:'app-media-video',behaviors:[Polymer.IronResizableBehavior],properties:{source:{type:Object,notify:!0,observer:'_sourceChanged'},contain:{type:Boolean,value:!1},mirror:{type:Boolean,value:!1},muted:{type:Boolean,value:!1},autoplay:{type:Boolean,value:!1},loop:{type:Boolean,value:!1},videoElement:{type:Object,notify:!0,readOnly:!0},sourceRect:{type:Object,notify:!0,readOnly:!0,value:function(){return{top:0,left:0,width:0,height:0}}},viewportRect:{type:Object,notify:!0,readOnly:!0}},listeners:{"videoElement.loadedmetadata":'_updateMetrics',"iron-resize":'_updateMetrics'},observers:['_updateMetrics(contain, mirror)'],attached:function(){this._setVideoElement(this.$.videoElement),this._updateMetrics()},play:function(){this.$.videoElement.play()},pause:function(){this.$.videoElement.pause()},_sourceChanged:function(){var a=this.$.videoElement.src,b=this.$.videoElement.paused;if('string'===typeof this.source)this.$.videoElement.src=this.source;else try{this.$.videoElement.srcObject=this.source}catch(a){this.source instanceof Blob?this.$.videoElement.src=URL.createObjectURL(this.source):this._error(this._logf(a))}if('string'===typeof a)try{URL.revokeObjectURL(a)}catch(a){}!b&&this.$.videoElement.paused&&this.play()},_updateMetrics:function(){this.debounce('_updateMetrics',function(){var a=this.$.videoElement.videoWidth,b=this.$.videoElement.videoHeight;if(!a||!b)return void(this.$.videoElement.style.visibility='hidden');this.$.videoElement.style.visibility='';this.$.videoElement.style.transform='';var c,d=this.$.videoElement.getBoundingClientRect(),e=this.getBoundingClientRect(),f=e.width/e.height,g=a/b,h=this.contain?g<f:g>f,i=a/d.width;c=h?e.height/d.height:e.width/d.width,this._setViewportRect(e);var j=e.width/c,k=e.height/c,l=(d.width-j)*i,m=(d.height-k)*i;this._setSourceRect({left:l/2,top:m/2,width:j*i,height:k*i}),this.$.videoElement.style.transform='scale('+(this.mirror?-c:c)+','+c+')'})}})})();</script></dom-module><script>const GraniteJsDependenciesGrabberMixin=(a)=>class extends a{static get properties(){return{history:{type:String,value:'',notify:!0},debug:{type:Boolean,value:!1}}}connectedCallback(){super.connectedCallback()}_getDependency(a){return()=>new Promise(a)}_namespaceExists(a){let b=window,c=a.split('.');for(let d,e=0;e<c.length;e++){if(d=c[e],!b[d])return!1;b=b[d]}return!0}_getDependencyPromiseResolve(a,b){return(c)=>{this._namespaceExists(a)?(this.debug&&console.log('[GraniteJsDependenciesGrabberMixin] _getDependency - found',a),this.history+=`_getDependency - found ${a} <br>`,this.dispatchEvent(new CustomEvent('dependency-is-ready',{detail:{name:a,url:b}})),c()):(this.debug&&console.log('[GraniteJsDependenciesGrabberMixin] _getDependency - unmet',a),this.history+=`_getDependency - unmet ${a} <br>`,window[`_downloading_${a}`]?this._waitToLoadDependency(a,b,c):(window[`_downloading_${a}`]=!0,this._loadDependency(a,b,c)))}}_loadDependency(a,b,c){var d=document.createElement('script');d.src=this.resolveUrl(b),d.onload=()=>{this.debug&&console.log('[GraniteJsDependenciesGrabberMixin] _loadDependency - loaded',a),this.history+=`_loadDependency - loaded ${a} <br>`,this._waitToLoadDependency(a,b,c)},document.body.appendChild(d)}_waitToLoadDependency(a,b,c){window;return this._namespaceExists(a)?void(this.debug&&console.log('[GraniteJsDependenciesGrabberMixin] _waitToLoadDependency - got',a),this.history+=`_waitToLoadDependency - got ${a} <br>`,this.dispatchEvent(new CustomEvent('dependency-is-ready',{detail:{name:a,url:b}})),c()):void window.setTimeout(()=>{this._waitToLoadDependency(a,b,c)},5)}};</script><dom-module id="granite-js-dependencies-grabber" assetpath="../bower_components/granite-js-dependencies-grabber/"><script>class GraniteJsDependenciesGrabber extends GraniteJsDependenciesGrabberMixin(Polymer.Element){static get is(){return'granite-js-dependencies-grabber'}static get properties(){return{dependencies:{type:Array,observer:'_onDependenciesChange',value:()=>[]}}}_onDependenciesChange(){if(!this.dependencies||0==this.dependencies.length)return;if(!this._areValidDependencies)return this.console.error('[granite-js-dependencies-grabber] Dependencies list malformed'),void(this.history+='Dependencies list malformed <br>');let a=Promise.resolve();this.dependencies.forEach((b)=>{this.debug&&console.log(`Adding dependency ${b.name} to chain`),this.history+=`Adding dependency ${b.name} to chain <br>`,a=a.then(this._getDependency(this._getDependencyPromiseResolve(b.name,b.url)))})}_areValidDependencies(){return this.dependencies.forEach((a)=>{if(!a.name||'string'!=typeof a.name||!a.url||'string'!=typeof a.url)return!1}),!0}connectedCallback(){super.connectedCallback()}}window.customElements.define(GraniteJsDependenciesGrabber.is,GraniteJsDependenciesGrabber);</script></dom-module><dom-module id="granite-qrcode-decoder" assetpath="../bower_components/granite-qrcode-decoder/"><template><style>:host{display:block;}</style><granite-js-dependencies-grabber dependencies="[{&quot;name&quot;:&quot;qrcode&quot;,&quot;url&quot;:&quot;../jsqrcode/dist/jsqrcode.js&quot;}]" on-dependency-is-ready="_onDependencyIsReady" debug="[[debug]]"></granite-js-dependencies-grabber></template><script>class GraniteQrcodeDecoder extends Polymer.Element{static get is(){return'granite-qrcode-decoder'}static get properties(){return{lastDecodedData:{type:String,notify:!0,value:''},debug:{type:Boolean,value:!1},dataUrl:{type:String,observer:'_onDataUrlChange'},blob:{type:Object,observer:'_onBlobChanged'},_qrcodeReady:{type:Boolean,value:!1,observer:'_onDataUrlChange'}}}static get observers(){return['_onDataUrlChange(_qrcodeReady)','_onBlobChanged(_qrcodeReady)']}connectedCallback(){super.connectedCallback()}_onQrcodeReadyChanged(){this.debug&&console.log('[granite-qrcode-decoder] _onQrcodeReadyChanged',this._qrcodeReady)}_onDependencyIsReady(){this._qrcodeReady=!0,qrcode.callback=(a)=>{this.lastDecodedData=a,this.debug&&console.log('[granite-qrcode-decoder] qrcode.callback',this.lastDecodedData),this.dispatchEvent(new CustomEvent('qrcode-decoded',{detail:this.lastDecodedData}))},this.debug&&console.log('[granite-qrcode-decoder] _onDependencyIsReady',this._qrcodeReady)}_onDataUrlChange(){console.log('[granite-qrcode-decoder] _onDataUrlChange',this._qrcodeReady),this._qrcodeReady&&this.dataUrl&&(this.debug&&console.log('[granite-qrcode-decoder] _onDataUrlChange',this.dataUrl),qrcode.decode(this.dataUrl))}_onBlobChanged(){if(console.log('[granite-qrcode-decoder] _onBlobChanged',this.blob,this._qrcodeReady),this._qrcodeReady&&this.blob){let a=new FileReader;a.readAsDataURL(this.blob),a.onloadend=()=>{this.dataUrl=a.result,this.debug&&console.log('[granite-qrcode-decoder] _onBlobChanged',this.dataUrl)}}}decodeCanvas(a){return this._qrcodeReady?void qrcode.decode('',a):void setTimeout(()=>this.decodeCanvas(a),1e3)}}window.customElements.define(GraniteQrcodeDecoder.is,GraniteQrcodeDecoder);</script></dom-module><dom-module id="app-media-image-capture" assetpath="../bower_components/app-media/"><script>Polymer.AppMedia=Polymer.AppMedia||{},Polymer.AppMedia.MeteringMode={SINGLE_SHOT:'single-shot',CONTINUOUS:'continuous',MANUAL:'manual',NONE:'none'},Polymer.AppMedia.FillLightMode={AUTO:'auto',OFF:'off',FLASH:'flash'},function(){if(null==window.ImageCapture)return void Polymer.Base._warn('Image Capture API is not supported in this browser!');var a=['whiteBalanceMode','colorTemperature','exposureMode','exposureCompensation','iso','focusMode','pointsOfInterest','brightness','contrast','saturation','sharpness','zoom','torch'],b=['fillLightMode','imageHeight','imageWidth'];Polymer({is:'app-media-image-capture',properties:{stream:{type:Object},trackIndex:{type:Number,value:0},videoTrack:{type:Object,notify:!0,computed:'__computeVideoTrack(stream, trackIndex)'},imageCapture:{type:Object,notify:!0,computed:'__computeImageCapture(videoTrack)'},lastPhoto:{type:Object,notify:!0,readOnly:!0},lastFrame:{type:Object,notify:!0,readOnly:!0},photoCapabilities:{type:Object,readOnly:!0,notify:!0},trackCapabilities:{type:Object,notify:!0,computed:'__computeTrackCapabilities(imageCapture, videoTrack)'},photoSettings:{type:Object,readOnly:!0,notify:!0},fillLightMode:{type:String,value:null},imageHeight:{type:Number,value:null},imageWidth:{type:Number,value:null},redEyeReduction:{type:Boolean,value:null},trackConstraints:{type:Object,readOnly:!0,notify:!0},whiteBalanceMode:{type:String,value:null},colorTemperature:{type:Number,value:null},exposureMode:{type:String,value:null},exposureCompensation:{type:Number,value:null},iso:{type:Number,value:null},focusMode:{type:String,value:null},pointsOfInterest:{type:Array,value:null},brightness:{type:Number,value:null},contrast:{type:Number,value:null},saturation:{type:Number,value:null},sharpness:{type:Number,value:null},zoom:{type:Number,value:null},torch:{type:Boolean,value:null}},observers:['__updatePhotoCapabilities(imageCapture, videoTrack)','__updatePhotoSettings(imageCapture, photoCapabilities, fillLightMode, imageHeight, imageWidth, redEyeReduction)','__updateTrackConstraints(imageCapture, trackCapabilities, whiteBalanceMode, exposureMode, focusMode, pointsOfInterest, exposureCompensation, colorTemperature, iso, brightness, contrast, saturation, sharpness, zoom, torch)'],takePhoto:function(){return null==this.imageCapture?Promise.reject(new Error('ImageCapture instance not ready.')):this.imageCapture.takePhoto(this.photoSettings).then(function(a){return this._setLastPhoto(a),a}.bind(this))},grabFrame:function(){return null==this.imageCapture?Promise.reject(new Error('ImageCapture instance not ready.')):this.imageCapture.grabFrame().then(function(a){return this._setLastFrame(a),a}.bind(this))},__computeVideoTrack:function(a,b){return null==a||null==b?void 0:a.getVideoTracks()[b]},__computeImageCapture:function(a){return new ImageCapture(a)},__computeTrackCapabilities:function(a,b){return null==a||null==b?void 0:b.getCapabilities()},__updatePhotoCapabilities:function(){this.debounce('updatePhotoCapabilities',function(){this.imageCapture.getPhotoCapabilities().then(function(a){this._setPhotoCapabilities(a)}.bind(this)).catch(function(a){this.fire('image-capture-capabilities-error',a)}.bind(this))})},__updateTrackConstraints:function(){this.debounce('updateTrackConstraints',function(){var b=this.__generateConfigurationObject(this.trackCapabilities,a);this._setTrackConstraints(b)})},__updatePhotoSettings:function(){this.debounce('updatePhotoSettings',function(){if(null!=this.photoCapabilities){var a=this.__generateConfigurationObject(this.photoCapabilities,b);null!=this.redEyeReduction&&'controllable'===this.photoCapabilities.redEyeReduction&&(a.redEyeReduction=this.redEyeReduction),this._setPhotoSettings(a)}})},__generateConfigurationObject:function(a,b){var c={};if(null!=a)for(var d=0;d<b.length;++d){var e=b[d],f=this[e],g=a[e],h=Array.isArray(g);null==f||null==g||!1===g||h&&-1===g.indexOf(f)||(!h&&g instanceof Object&&(g.min>=f?f=g.min:g.max<=f&&(f=g.max)),c[e]=f)}return c}})}();</script></dom-module><script>class GraniteAppMediaPeriodicImageCapture extends window.customElements.get('app-media-image-capture'){static get is(){return'granite-app-media-periodic-image-capture'}static get properties(){return{frequency:{type:Number,value:10,observer:'_onFrequencyChange'},capture:{type:Boolean,value:!1,observer:'_onCaptureChange'},debug:{type:Boolean,value:!1},_timeoutId:{type:Number,value:0}}}_onFrequencyChange(){(1e-3>this.frequency||100<this.frequency)&&(console.error('Frequency must be between 0.001 and 100 images per second'),this.frequency=10),this.debug&&console.log('[granite-app-media-periodic-image-capture] _onFrequencyChange',this.capture,this.frequency),this.capture&&(this._stopCapture(),this._startCapture())}_onCaptureChange(){return this.debug&&console.log('[granite-app-media-periodic-image-capture] _onCaptureChange',this.capture,this.frequency),this.capture?void this._startCapture():void this._stopCapture()}_doCapture(){this.takePhoto(),this.debug&&console.log('[granite-app-media-periodic-image-capture] _doCapture period',1e3/this.frequency),this._timeoutId=setTimeout(()=>{this.debug&&console.log('[granite-app-media-periodic-image-capture] _doCapture - capturing'),this._doCapture()},1e3/this.frequency),console.log('timeoutId',this._timeoutId)}_startCapture(){this.debug&&console.log('[granite-app-media-periodic-image-capture] _startCapture'),this._timeoutId||this._doCapture()}_stopCapture(){this.debug&&console.log('[granite-app-media-periodic-image-capture] _stopCapture'),this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}}window.customElements.define(GraniteAppMediaPeriodicImageCapture.is,GraniteAppMediaPeriodicImageCapture);</script><dom-module id="granite-qrcode-scanner" assetpath="../bower_components/granite-qrcode-scanner/"><template><style>:host{display:block;}[hide]{display:none !important;}#videoWindow{position:relative;}#videoWindow #buttonRow{position:absolute;bottom:1em;left:0;right:0;display:flex;flex-flow:row nowrap;justify-content:center;}#videoWindow #targetSquare{position:absolute;left:5em;right:5em;top:4em;bottom:6em;border:solid 5px rgba(200,200,200,0.5);}.media{display:flex;flex-flow:column nowrap;align-items:center;}</style><div class="media"><app-media-devices id="mediaDevices" on-devices-changed="_onDevicesChanged" on-selected-device-changed="_onSelectedDeviceChanged" devices="{{devices}}" selected-device="{{device}}" kind="videoinput"></app-media-devices><app-media-stream video-device="[[device]]" video-constraints="{&quot;width&quot;: {&quot;ideal&quot;: 480, &quot;max&quot;: 480}, &quot;height&quot;: {&quot;ideal&quot;: 480, &quot;max&quot;: 480}}" stream="{{videoStream}}" on-active-changed="_onActiveChanged" on-stream-changed="_onStreamChanged" active=""></app-media-stream><div id="videoWindow"><app-media-video id="video" source="[[videoStream]]" on-click="record" autoplay="" muted=""></app-media-video><div id="targetSquare"></div><paper-ripple id="ripple" noink=""></paper-ripple><template is="dom-if" if="[[!active]]"><div id="buttonRow"><paper-fab icon="granite-qrcode-scanner-icons:photo-camera" on-click="_takePhoto"></paper-fab></div></template></div></div><granite-app-media-periodic-image-capture id="imageCapture" capture="[[active]]" frequency="[[frequency]]" fill-light-mode="[[fillLightMode]]" stream="[[videoStream]]" focus-mode="single-shot" last-photo="{{photo}}" image-width="480" image-height="480" on-last-photo-changed="_onLastPhotoChanged" debug="[[debug]]"></granite-app-media-periodic-image-capture><granite-qrcode-decoder last-decoded-data="{{data}}" blob="[[photo]]" on-qrcode-decoded="_onQrcodeDecoded"></granite-qrcode-decoder><iron-iconset-svg name="granite-qrcode-scanner-icons" size="24"><svg><defs><g id="photo-camera"><circle cx="12" cy="12" r="3.2"></circle><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"></path></g></defs></svg></iron-iconset-svg></template><script>class GraniteQrcodeScanner extends Polymer.Element{static get is(){return'granite-qrcode-scanner'}static get properties(){return{frequency:{type:Number,value:10},active:{type:Boolean,value:!1},data:{type:String,notify:!0,value:''},debug:{type:Boolean,value:!1}}}_takePhoto(){this.debug&&console.log('[granite-qrcode-scanner] _takePhoto'),this.$.ripple.simulatedRipple(),this.$.imageCapture.takePhoto()}_onLastPhotoChanged(a){this.debug&&console.log('[granite-qrcode-scanner] _onLastPhotoChanged',a)}_onQrcodeDecoded(a){this.debug&&console.log('[granite-qrcode-scanner] _onQrcodeDecoded',a),this.dispatchEvent(new CustomEvent('qrcode-decoded',{detail:a.detail}))}}window.customElements.define(GraniteQrcodeScanner.is,GraniteQrcodeScanner);</script></dom-module><dom-module id="paper-dialog-scrollable" assetpath="../bower_components/paper-dialog-scrollable/"><template><style>:host{display:block;@apply --layout-relative;}:host(.is-scrolled:not(:first-child))::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:var(--divider-color);}:host(.can-scroll:not(.scrolled-to-bottom):not(:last-child))::after{content:'';position:absolute;bottom:0;left:0;right:0;height:1px;background:var(--divider-color);}.scrollable{padding:0 24px;@apply --layout-scroll;@apply --paper-dialog-scrollable;}.fit{@apply --layout-fit;}</style><div id="scrollable" class="scrollable" on-scroll="updateScrollState"><slot></slot></div></template></dom-module><script>Polymer({is:'paper-dialog-scrollable',properties:{dialogElement:{type:Object}},get scrollTarget(){return this.$.scrollable},ready:function(){this._ensureTarget(),this.classList.add('no-padding')},attached:function(){this._ensureTarget(),requestAnimationFrame(this.updateScrollState.bind(this))},updateScrollState:function(){this.toggleClass('is-scrolled',0<this.scrollTarget.scrollTop),this.toggleClass('can-scroll',this.scrollTarget.offsetHeight<this.scrollTarget.scrollHeight),this.toggleClass('scrolled-to-bottom',this.scrollTarget.scrollTop+this.scrollTarget.offsetHeight>=this.scrollTarget.scrollHeight)},_ensureTarget:function(){this.dialogElement=this.dialogElement||this.parentElement,this.dialogElement&&this.dialogElement.behaviors&&0<=this.dialogElement.behaviors.indexOf(Polymer.PaperDialogBehaviorImpl)?(this.dialogElement.sizingTarget=this.scrollTarget,this.scrollTarget.classList.remove('fit')):this.dialogElement&&this.scrollTarget.classList.add('fit')}});</script></div><dom-module id="test-camera"><template><paper-input id="input" value="{{data}}"></paper-input><granite-qrcode-scanner data="{{data}}" debug=""></granite-qrcode-scanner><div style="text-align:center; margin-top:1em;">Last decoded QR Code: [[data]]</div></template><button on-click="takePhoto">Add photo</button><script>Polymer({is:'test-camera',properties:{data:{type:String}},takePhoto:function(){},showQrScanDialog:function(){this.$.qrScanDialog.open()}});</script></dom-module></body></html>