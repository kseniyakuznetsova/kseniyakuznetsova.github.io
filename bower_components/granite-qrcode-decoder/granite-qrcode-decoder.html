<html><head><link rel="import" href="../polymer/polymer-element.html"><link rel="import" href="../granite-js-dependencies-grabber/granite-js-dependencies-grabber.html"></head><body><dom-module id="granite-qrcode-decoder"><template><style>:host{display:block;}</style><granite-js-dependencies-grabber dependencies="[{&quot;name&quot;:&quot;qrcode&quot;,&quot;url&quot;:&quot;../jsqrcode/dist/jsqrcode.js&quot;}]" on-dependency-is-ready="_onDependencyIsReady" debug="[[debug]]"></granite-js-dependencies-grabber></template><script>class GraniteQrcodeDecoder extends Polymer.Element{static get is(){return'granite-qrcode-decoder'}static get properties(){return{lastDecodedData:{type:String,notify:!0,value:''},debug:{type:Boolean,value:!1},dataUrl:{type:String,observer:'_onDataUrlChange'},blob:{type:Object,observer:'_onBlobChanged'},_qrcodeReady:{type:Boolean,value:!1,observer:'_onDataUrlChange'}}}static get observers(){return['_onDataUrlChange(_qrcodeReady)','_onBlobChanged(_qrcodeReady)']}connectedCallback(){super.connectedCallback()}_onQrcodeReadyChanged(){this.debug&&console.log('[granite-qrcode-decoder] _onQrcodeReadyChanged',this._qrcodeReady)}_onDependencyIsReady(){this._qrcodeReady=!0,qrcode.callback=(a)=>{this.lastDecodedData=a,this.debug&&console.log('[granite-qrcode-decoder] qrcode.callback',this.lastDecodedData),this.dispatchEvent(new CustomEvent('qrcode-decoded',{detail:this.lastDecodedData}))},this.debug&&console.log('[granite-qrcode-decoder] _onDependencyIsReady',this._qrcodeReady)}_onDataUrlChange(){console.log('[granite-qrcode-decoder] _onDataUrlChange',this._qrcodeReady),this._qrcodeReady&&this.dataUrl&&(this.debug&&console.log('[granite-qrcode-decoder] _onDataUrlChange',this.dataUrl),qrcode.decode(this.dataUrl))}_onBlobChanged(){if(console.log('[granite-qrcode-decoder] _onBlobChanged',this.blob,this._qrcodeReady),this._qrcodeReady&&this.blob){let a=new FileReader;a.readAsDataURL(this.blob),a.onloadend=()=>{this.dataUrl=a.result,this.debug&&console.log('[granite-qrcode-decoder] _onBlobChanged',this.dataUrl)}}}decodeCanvas(a){return this._qrcodeReady?void qrcode.decode('',a):void setTimeout(()=>this.decodeCanvas(a),1e3)}}window.customElements.define(GraniteQrcodeDecoder.is,GraniteQrcodeDecoder);</script></dom-module></body></html>