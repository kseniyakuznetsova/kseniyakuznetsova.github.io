<html><head><link rel="import" href="../polymer/polymer.html"></head><body><dom-module id="app-media-stream"><script>(function(){Polymer({is:'app-media-stream',properties:{audioDevice:{type:Object,value:null},videoDevice:{type:Object,value:null},audioConstraints:{type:Object,value:null},videoConstraints:{type:Object,value:null},stream:{type:Object,notify:!0,readOnly:!0},active:{type:Boolean,notify:!0,value:!1},constraints:{type:Object,readOnly:!0}},observers:['_updateConstraints(audioDevice, videoDevice, audioConstraints, videoConstraints)','_updateStream(constraints, active)'],_combineConstraints:function(a,b){if(null==a&&null==b)return!1;var c=this.extend({},a);return null!=b&&(c.deviceId={exact:b.deviceId}),c},_updateConstraints:function(){this.debounce('_updateConstraints',function(){var a=this._combineConstraints(this.audioConstraints,this.audioDevice),b=this._combineConstraints(this.videoConstraints,this.videoDevice);a||b?this._setConstraints({audio:a,video:b}):this._setConstraints(null)})},_updateStream:function(){this.active&&null!=this.constraints?this.debounce('_updateStream',function(){var a=this;try{null!=this.stream&&this.stream.getTracks().forEach(function(a){a.stop()}),this.__gettingUserMedia=this.__gettingUserMedia||navigator.mediaDevices.getUserMedia(this.constraints).then(function(b){a.__gettingUserMedia=null,a._setStream(a.active?b:null)}).catch(function(b){a.fire('media-stream-error',b),a._error(a._logf('Media stream access rejected.',b))})}catch(a){this.fire('media-stream-error',a),this._error(this._logf('Failed to access media stream.',a))}},1):this._setStream(null)}})})();</script></dom-module></body></html>